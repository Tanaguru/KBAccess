<%@taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<c:forEach var="entry" items="${testByRef}">
    <optgroup id="${entry.key.code}" label="${entry.key.label}">     
        <c:forEach var="test" items="${entry.value}">
            
            <c:choose>
                 <%-- If we're editing an existing testcase --%>
                <c:when test="${testcase != null}">                   
                    <c:choose>
                        <%-- We select its test --%>
                        <c:when test="${testcase.testLabel == test.label}">
                            <option value="${test.id}" selected="selected">${test.label}</option>
                        </c:when>
                        <c:otherwise>
                            <option value="${test.id}">${test.label}</option>
                        </c:otherwise>
                    </c:choose> 
                </c:when>
                
                <%-- Else we're addind a new testcase --%>
                <c:otherwise>
                    <option value="${test.id}">${test.label}</option>
                </c:otherwise>
            </c:choose>
                        
        </c:forEach>                  
    </optgroup>
</c:forEach>
